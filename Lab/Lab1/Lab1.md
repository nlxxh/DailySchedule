## Lab1学习报告

### 基本概念

#### 中断的种类
* 异常（Exception）：执行指令时产生的，通常无法预料的错误。例如：访问无效内存地址、执行非法指令（除以零）等
* 陷阱（Trap）：陷阱是一系列强行导致中断的指令，例如：系统调用（Syscall）等
* 硬件中断（Hardware Interrupt）：CPU 之外的硬件产生的异步中断，例如：时钟中断、外设发来数据等

|中断                 |源头                  |响应方式              |处理机制             |
|---------------------|---------------------|---------------------|---------------------|
|异常                 |应用程序意想不到的行为 |同步                  |杀死应用程序或者重新执行 |
|陷阱                 |应用程序请求OS服务     |同步或异步            |等待和持续          |
|硬件中断             | 外设                 |异步                  |持续，对应用程序透明 |

#### 中断相关寄存器(CSR)

##### 硬件自动填写的寄存器
* sepc：记录触发中断的那条指令的地址
* scause：记录中断发生的原因，还会记录该中断是不是一个外部中断
* stval：记录一些中断处理所需要的辅助信息，比如取指、访存、缺页异常
#####  设置的寄存器
* stvec，设置如何寻找 S 态中断处理程序的起始地址，保存了中断向量表基址 BASE，同时还有模式 MODE
当MODE=0时，设置为 Direct 模式，无论中断因何发生我们都直接跳转到基址pc←BASE   
当MODE=1时，设置为 Vectored 模式，遇到中断我们会进行跳转如下：pc←BASE+4×cause   
只需将各中断处理程序放在正确的位置，并设置好 stvec ，遇到中断的时候硬件根据中断原因就会自动跳转到对应的中断处理程序
* sstatus：S 态控制状态寄存器。保存全局中断使能标志，以及许多其他的状态。可设置此寄存器来中断使能与否
* sie：用来控制具体类型中断的使能，例如其中的 STIE 控制时钟中断使能   
* sip：和 sie 相对应，记录每种中断是否被触发   
仅当 sie 和 sip 的对应位都为 1 时，意味着开中断且已发生中断，这时中断最终触发

#### 中断相关指令

##### 进入和退出中断
* ecall：触发中断，进入更高一层的中断处理流程之中。用户态->内核态中断处理流程，内核态->机器态
* sret：从内核态返回用户态，同时将 pc 的值设置为 sepc（如果需要返回到 sepc 后一条指令，就需要在 sret 之前修改 sepc 的值）
* ebreak：触发一个断点
* mret：从机器态返回内核态，同时将 pc 的值设置为 mepc
##### 操作CSR
* csrrw dst, csr, src：同时读写的原子操作，将指定 CSR 的值写入 dst，同时将 src 的值写入 CSR
* csrr dst, csr：将指定 CSR 的值写入 dst
* csrw csr, src：将指定 src 的值写入 CSR


#### 建立中断机制
* 建立中断服务例程
* 让CPU能响应中断
* 响应并处理中断
* 保存和恢复现场

### 
